<!DOCTYPE html>
<!-- saved from url=(0043)http://tb.lelanlan.com/vipart?code=a4dhwtj1 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>乐兰网_文章自助</title>
    <link rel="icon" href="http://tb.lelanlan.com/static/img/logo.png">
    
    <meta name="Description" content="CSDN,百度文库,千图,包图,千库,90后等免积分会员站币,文件素材自助下载服务">
    <meta name="keywords" content="CSDN文件免积分,自助下载,丹池网">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="referrer" content="no-referrer">
    <link rel="stylesheet" href="./乐兰网_文章自助_files/layui.css">
    <link rel="stylesheet" href="./乐兰网_文章自助_files/global.css">
    <link rel="stylesheet" href="./乐兰网_文章自助_files/btnCss.css">
    <script src="./乐兰网_文章自助_files/hm.js.下载"></script><script src="./乐兰网_文章自助_files/jquery.min.js.下载"></script>
    <script src="./乐兰网_文章自助_files/layui.js.下载"></script>
    <script src="./乐兰网_文章自助_files/Feng.js.下载"></script>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?31cc9baa0178e2444ed4276039695007";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
    <style>
        .img-box{
            padding-bottom:7%;
        }
        .img-box img {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            margin: 0;
        }
    </style>
<link id="layuicss-layer" rel="stylesheet" href="./乐兰网_文章自助_files/layer.css" media="all"></head>
<body>

<div class="row">
    <div class="layui-col-md12">
        <div class="img-box"><a href="https://www.aliyun.com/1111/2019/group-buying-share?ptCode=06BA8C4F77FB6C777CDFAB090AE47877647C88CF896EF535&amp;userCode=43a5c9id&amp;share_source=aliyun_app" onclick="_hmt.push([&#39;_trackEvent&#39;, &#39;act&#39;, &#39;click&#39;, &#39;pic&#39;])" target="_blank"><img src="./乐兰网_文章自助_files/1200-90.jpg" style="
    display: none;
"></a></div>
    </div>
</div>
<div class="layui-main" id="openforArticle"><article class="baidu_pl"> 
 <!--python安装手册开始--> 
 <!--python安装手册结束--> 
 <div id="article_content" class="article_content clearfix"> 
  <div class="article-copyright"> 
   <span class="creativecommons"> <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"> </a> <span> 版权声明：本文为博主原创文章，遵循<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> CC 4.0 BY-SA </a>版权协议，转载请附上原文出处链接和本声明。 </span> 
    <div class="article-source-link2222">
      本文链接：
     <a href="https://blog.csdn.net/weixin_44464760/article/details/97922823">https://blog.csdn.net/weixin_44464760/article/details/97922823</a> 
    </div> </span> 
  </div> 
  <!--一个博主专栏付费入口--> 
  <!--一个博主专栏付费入口结束--> 
  <link rel="stylesheet" href="./乐兰网_文章自助_files/ck_htmledit_views-4a3473df85.css"> 
  <div id="content_views" class="markdown_views prism-atom-one-dark"> 
   <!-- flowchart 箭头图标 勿删 --> 
   <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> 
    <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path> 
   </svg> 
   <p>3dtiles作为由cesium公开的三维瓦片数据协议，其相关文档可以参考如下连接的文档</p> 
   <p><a href="https://cesium.com/presentations/files/3DTilesInAction.pdf" rel="nofollow">https://cesium.com/presentations/files/3DTilesInAction.pdf</a></p> 
   <p>3dtiles作为一个三维空间瓦片化分，提供了支持大场景加载的基础。tileset.json作为三维空间划分数据的入口，组织了一棵三维空间瓦片树。</p> 
   <p>关于该三维空间树的数据结构可参考如下文章连接</p> 
   <p><a href="https://github.com/AnalyticalGraphicsInc/3d-tiles/tree/master/specification" rel="nofollow">https://github.com/AnalyticalGraphicsInc/3d-tiles/tree/master/specification</a></p> 
   <p>以下3dtiles实现以八叉树数据结构，b3dm模型数据为例进行描述介绍。</p> 
   <p>我们现对模型数据进行数据的空间划分，进行数据预处理，从而减少客户端需要进行数据处理的时间以及计算复杂度。</p> 
   <p>将模型按照空间划分，采用空间八叉树的方式，以模型的包围盒进行计算像素误差，并归并如像素误差对应的八叉树层级。</p> 
   <p>将每个空间节点的模型进行合并，成为一个b3dm的数据文件。b3dm的数据格式相关的文档连接如下</p> 
   <p><a href="https://github.com/AnalyticalGraphicsInc/3d-tiles/tree/master/specification/TileFormats/BatchTable" rel="nofollow">https://github.com/AnalyticalGraphicsInc/3d-tiles/tree/master/specification/TileFormats/BatchTable</a></p> 
   <p>在数据组织生成时，将相同材质部分的模型进行合并，该数据能有效的减少drawcall，配合batchtable的使用，能仍支持每个模型的区分。</p> 
   <p>由于threejs没有提供b3dm文件的加载格式，由于b3dm数据与gltf格式接近，可以使用gltfloader.js进行改造得到。</p> 
   <p>解析后得到threejs的mesh数据格式。将解析出来的mesh数据进行处理。处理成一个mesh，相同材质模型数据合并。<br> <img src="./乐兰网_文章自助_files/20190731152859379.png" alt="数据处理过程"><br> 在cesium中使用了特定的shader进行picking的支持，使用depth进行三维点的计算，picking着色时使用batchid进行模型的单个着色。该方法没有额外的drawcall开销。</p> 
   <p>该方法在threejs中实现需要自行开发shader。</p> 
   <p>简单实现则是使用计算出来的每个模型对应mesh索引区间生成一个新的group，将整个mesh使用新的材质组进行渲染，但是会明显增加drawcall。重排索引能减少drawcall的次数，但会增加cpu与gpu数据重传的开销。方案具体分析问题具体采用实现。</p> 
   <p>当然编写一个shader支持使用batchid方式的着色技术性能更加卓越，应没有使用该方式，故不做具体分析。</p> 
   <p>关于在3dtiles数据基础上实现picking的方式<br> <img src="./乐兰网_文章自助_files/20190731153101283.png" alt="gpu picking过程"><br> 由于threejs的深度图精度只有255，存在较大的误差，需要提高精度做如下深度图设置<br> depthMaterial.depthPacking = THREE.RGBADepthPacking;</p> 
   <p>gpu中深度分布公式参考如下文章<br> <a href="https://developer.nvidia.com/content/depth-precision-visualized" rel="nofollow">https://developer.nvidia.com/content/depth-precision-visualized</a><br> <a href="https://www.sjbaker.org/steve/omniv/love_your_z_buffer.html" rel="nofollow">https://www.sjbaker.org/steve/omniv/love_your_z_buffer.html</a><br> depth的分布公式如下<br> z_buffer_value = (1&lt;&lt;N) * ( a + b / z )</p> 
   <p>将深度值计算为空间坐标的算法可参考如下文档连接<br> <a href="https://mynameismjp.wordpress.com/2010/09/05/position-from-depth-3/" rel="nofollow">https://mynameismjp.wordpress.com/2010/09/05/position-from-depth-3/</a></p> 
   <p>设置logarithmicDepthBuffer为true能提高深度值的精度。//这个没有测试出预期结果<br> <img src="./乐兰网_文章自助_files/20190802103108867.png" alt="在这里插入图片描述"><br> 从计算公式上看是有一定理论依据的</p> 
   <p>实现后如下</p> 
   <pre><code>//color为读取深度图得到的rgba颜色
var temp = 256;
var depth = 0;
for (var i = 3; i &gt;= 0; --i) {    //rgba (从a 开始) 读4 个字节
 depth += color[i] / temp;
    temp *= 256;
}

//根据depth深度分布公式推导的计算公式，推导过程省略
depth = camera.near * camera.far / (camera.near * depth + camera.far * (1 - depth)); //转换为长度后的深度值
var dist = depth / camera.getWorldDirection().dot(raycaster.ray.direction);  //除以cos(alpha)
 
let direction = raycaster.ray.direction.normalize();
 
var position = new THREE.Vector3(0, 0, 0).addVectors(camera.position, direction.multiplyScalar(dist));
</code></pre> 
   <p>一下为相关的picking示例<br> <a href="https://raw.githack.com/1147079942/three.js/gpu_picking/examples/webgl_gpu_picking_point.html" rel="nofollow">https://raw.githack.com/1147079942/three.js/gpu_picking/examples/webgl_gpu_picking_point.html</a></p> 
  </div> 
  <link href="./乐兰网_文章自助_files/markdown_views-b6c3c6d139.css" rel="stylesheet"> 
 </div> 
</article></div>
<script>
    //注意：导航 依赖 element 模块，否则无法进行功能性操作
    var downUrlReg = /(https:\/\/blog.csdn.net\/\w+\/\w+\/\w+)/;
    layui.use(['element', 'form'], function () {
        var element = layui.element;
        var form = layui.form;
        var code = getParam("code");
        $("#code").val(code);
        // if (code != null && typeof code != 'undefined' && code.length > 0) {
        //     $('#buy').hide();
        // }

        /**
         * 获取指定的URL参数值
         */
        function getParam(paramName) {
            paramValue = "", isFound = !1;
            if (this.location.search.indexOf("?") == 0 && this.location.search.indexOf("=") > 1) {
                arrSource = unescape(this.location.search).substring(1, this.location.search.length).split("&"), i = 0;
                while (i < arrSource.length && !isFound) arrSource[i].indexOf("=") > 0 && arrSource[i].split("=")[0].toLowerCase() == paramName.toLowerCase() && (paramValue = arrSource[i].split("=")[1], isFound = !0), i++
            }
            return paramValue == "" && (paramValue = null), paramValue
        }
    });

    function downArticle() {
        $("#file").attr("href", "")
        $("#file").attr("download", "")
        var code = $("#code").val();
        var downUrl = $("#downUrl").val();
        if (!downUrlReg.test(downUrl)) {
            layer.msg("请输入正确下载地址格式！https://blog.csdn.net/xx/xx");
            return;
        }
        var email = $("#email").val();
        var operation = function () {
            $.ajax({
                url: "/api/getVipArticleFile",
                data: {"code": code, "downUrl": downUrl, "email": email},
                beforeSend:function(){
                    $("#loading").html("<img src='/static/img/loading.gif' />"); //在请求后台数据之前显示loading图标
                },
                success: function (response) {
                    if (response.status == 1) {
                        if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)){
                            document.getElementById("openforArticle").innerHTML = response.result;
                        }else{
                            // var ow = window.open();
                            // ow.document.write(response.result);
                            // ow.document.clear();
                            document.getElementById("openforArticle").innerHTML = response.result;
                        }
                    } else {
                        layer.msg(response.msg);
                    }
                },
                complete: function () {
                    $('#loading').remove();
                }
            });
        }
        Feng.confirm("确认文章链接无误吗？该激活码只能使用一次！", operation);
    }
</script>

<div class="layui-layer-move"></div></body></html>